---
// src/components/HeaderControls.astro
import ThemeIcon from './ThemeIcon.astro';

const themes = ['neobrutalist', 'square', 'liquid-glass'] as const;
---
<div class="flex items-center gap-4">
  <div id="theme-switcher-container" class="relative" data-state="closed">
    <button id="theme-switcher-trigger" type="button" class="text-text p-1.5 rounded-btn border border-text/50 hover:border-primary">
      {themes.map(theme => (
        <div data-icon-for={theme} class="theme-icon-wrapper">
          <ThemeIcon theme={theme} />
        </div>
      ))}
    </button>

    <div id="theme-options" class="absolute top-full mt-2 p-1 w-max rounded-main shadow-lg">
      <div class="flex flex-col items-center gap-1">
        {themes.map((theme) => (
          <button 
            type="button"
            data-theme-button={theme}
            class="theme-button p-1.5 rounded-btn hover:bg-white/10 w-full"
            aria-label={`Cambiar a tema ${theme}`}
          >
            <ThemeIcon theme={theme} />
          </button>
        ))}
      </div>
    </div>
  </div>

  <button id="mode-toggle" type="button" class="text-text p-1.5 rounded-btn border border-text/50 hover:border-primary transition-colors flex-shrink-0">
    <svg class="sun-icon h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2V4M12 20V22M4 12H2M6.31412 6.31412L4.8999 4.8999M17.6859 6.31412L19.1001 4.8999M6.31412 17.69L4.8999 19.1042M17.6859 17.69L19.1001 19.1042M22 12H20M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12C7 9.23858 9.23858 7 12 7C14.7614 7 17 9.23858 17 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <svg class="moon-icon h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M22 15.8442C20.6866 16.4382 19.2286 16.7688 17.6935 16.7688C11.9153 16.7688 7.23116 12.0847 7.23116 6.30654C7.23116 4.77135 7.5618 3.3134 8.15577 2C4.52576 3.64163 2 7.2947 2 11.5377C2 17.3159 6.68414 22 12.4623 22C16.7053 22 20.3584 19.4742 22 15.8442Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
</div>


<style is:global>
  /* --- LÓGICA DEL BOTÓN DE MODO --- */
  .moon-icon { display: block; }
  .sun-icon { display: none; }
  [data-mode="dark"] .moon-icon { display: none; }
  [data-mode="dark"] .sun-icon { display: block; }

  /* --- LÓGICA DEL BOTÓN DE TEMA ACTIVO --- */
  .theme-icon-wrapper { display: none; }
  .theme-icon-wrapper[data-active='true'] { display: block; }
  
  /* --- LÓGICA DE ANIMACIÓN Y POSICIÓN DEL PANEL --- */
  #theme-options {
    transition: opacity 0.2s ease, transform 0.2s ease;
    opacity: 0;
    transform: scale(0.95) translateY(-10px) translateX(-50%);
    pointer-events: none;
    transform-origin: top center;
    left: 50%;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  #theme-switcher-container[data-state='open'] #theme-options {
    opacity: 1;
    transform: scale(1) translateY(0) translateX(-50%);
    pointer-events: auto;
  }
  
  /* ESTILOS DEL PANEL DESPLEGABLE */

  /* --- Panel para TEMA CUADRADO --- */
  [data-theme='square'] #theme-options {
    background-color: #18181b;
  }
  [data-theme='square'][data-mode='light'] #theme-options svg {
    color: white;
  }
  
  /* --- PANEL NEOBRUTALISTA (SEPARADO Y CORREGIDO) --- */
  [data-theme='neobrutalist'] #theme-options {
    background-color: var(--accent-color);
    border: 2px solid var(--text-color);
    box-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--shadow-color);
  }
  [data-theme='neobrutalista'] #theme-options svg {
    color: var(--bg-color);
  }

  /* --- Panel para LIQUID GLASS --- */
  [data-theme='liquid-glass'][data-mode='light'] #theme-options {
    background: rgba(255, 255, 255, 0.5);
    -webkit-backdrop-filter: blur(16px);
    backdrop-filter: blur(16px);
  }
  [data-theme='liquid-glass'][data-mode='dark'] #theme-options {
    background: rgba(12, 28, 43, 0.5);
    -webkit-backdrop-filter: blur(16px);
    backdrop-filter: blur(16px);
  }

  /* SOMBRA Y HOVER PARA BOTONES DEL HEADER (NEOBRUTALISMO)*/
  
  /* Estado base de los botones en tema Neobrutalista */
  [data-theme='neobrutalist'] #theme-switcher-trigger,
  [data-theme='neobrutalist'] #mode-toggle {
    box-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--shadow-color);
    transition: all 0.2s ease-out;
  }

  /* Estado hover para agrandar la sombra */
  [data-theme='neobrutalist'] #theme-switcher-trigger:hover,
  [data-theme='neobrutalist'] #mode-toggle:hover {
    box-shadow: 6px 6px 0 var(--shadow-color); /* Aumentamos el offset de 4px a 8px */
    transform: translate(-1px, -1px); /* Opcional: un pequeño movimiento para más feedback */
  }
</style>